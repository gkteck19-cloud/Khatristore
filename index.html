<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Khatri Store - माँ भगवती इलेक्ट्रिकल्स</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .product-card:active { transform: scale(0.98); }
    </style>
</head>
<body class="bg-gray-50 text-slate-900 font-sans">

    <div id="app">
        <div class="flex items-center justify-center h-screen">
            <div class="text-center">
                <div class="w-12 h-12 border-4 border-orange-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
                <p class="font-bold text-slate-600">खत्री स्टोर लोड हो रहा है...</p>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, getDocs, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // आपकी असली Firebase Config
        const firebaseConfig = {
            apiKey: "AIzaSyBhNDgsAtOsxdfNGfTEqbuQoYgbtTjUSVo",
            authDomain: "khatri-online.firebaseapp.com",
            projectId: "khatri-online",
            storageBucket: "khatri-online.firebasestorage.app",
            messagingSenderId: "117940742720",
            appId: "1:117940742720:web:5d7dce7c186199e9fbcda5"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        let cart = [];

        // --- 1. प्रोडक्ट्स लोड करने का फंक्शन ---
        async function renderApp() {
            const querySnapshot = await getDocs(collection(db, "products"));
            let productsHtml = "";

            querySnapshot.forEach((doc) => {
                const item = doc.data();
                productsHtml += `
                    <div class="bg-white p-3 rounded-2xl shadow-sm border border-gray-100 flex flex-col product-card transition">
                        <img src="${item.image}" class="h-32 object-contain mb-2 rounded-lg" onclick="showDetail('${doc.id}')">
                        <h3 class="font-bold text-xs mb-1 line-clamp-2 h-8" onclick="showDetail('${doc.id}')">${item.name}</h3>
                        <p class="text-slate-900 font-black text-lg mb-2">₹${item.price}</p>
                        <button onclick="addToCart('${item.name}', ${item.price})" class="w-full bg-slate-900 text-white py-2 rounded-xl text-[10px] font-bold uppercase hover:bg-orange-500 transition">Add to Cart</button>
                    </div>
                `;
            });

            document.getElementById('app').innerHTML = `
                <nav class="bg-slate-900 text-white p-4 sticky top-0 z-50 flex justify-between items-center shadow-xl">
                    <h1 class="text-xl font-black italic text-orange-400">KHATRI STORE</h1>
                    <div class="relative cursor-pointer" onclick="toggleCart()">
                        <i data-lucide="shopping-cart"></i>
                        <span id="cart-count" class="absolute -top-2 -right-2 bg-orange-500 text-[10px] w-4 h-4 rounded-full flex items-center justify-center font-bold">${cart.length}</span>
                    </div>
                </nav>

                <div class="bg-slate-900 text-white px-4 pb-8 pt-2 rounded-b-[40px] text-center mb-6 shadow-2xl">
                    <p class="text-sm opacity-70">माँ भगवती इलेक्ट्रिकल्स में आपका स्वागत है</p>
                    <h2 class="text-2xl font-bold mt-1">बेहतरीन क्वालिटी, सही दाम</h2>
                </div>

                <div class="max-w-7xl mx-auto px-4 grid grid-cols-2 md:grid-cols-4 gap-4 mb-20">
                    ${productsHtml || '<p class="col-span-2 text-center text-gray-400 py-10">कोई सामान नहीं मिला।</p>'}
                </div>

                <div id="cart-drawer" class="fixed inset-0 bg-black/50 z-[100] hidden flex justify-end">
                    <div class="w-full max-w-xs bg-white h-full p-6 flex flex-col">
                        <div class="flex justify-between items-center mb-6 border-b pb-4">
                            <h2 class="text-xl font-bold">आपका कार्ट</h2>
                            <button onclick="toggleCart()"><i data-lucide="x"></i></button>
                        </div>
                        <div id="cart-items" class="flex-1 overflow-y-auto space-y-4"></div>
                        <div class="mt-auto pt-6 border-t">
                            <div class="flex justify-between text-2xl font-bold mb-6">
                                <span>Total:</span><span class="text-orange-500" id="cart-total">₹0</span>
                            </div>
                            <button onclick="placeOrder()" class="w-full bg-slate-900 text-white py-4 rounded-2xl font-bold shadow-lg">PLACE ORDER</button>
                        </div>
                    </div>
                </div>
            `;
            lucide.createIcons();
        }

        // --- 2. कार्ट फंक्शनलिटी ---
        window.addToCart = (name, price) => {
            cart.push({ name, price });
            updateCartUI();
        };

        window.toggleCart = () => {
            const drawer = document.getElementById('cart-drawer');
            drawer.classList.toggle('hidden');
            updateCartUI();
        };

        function updateCartUI() {
            const cartList = document.getElementById('cart-items');
            const totalEl = document.getElementById('cart-total');
            const countEl = document.getElementById('cart-count');
            
            countEl.innerText = cart.length;
            let total = 0;
            cartList.innerHTML = cart.map((item, index) => {
                total += item.price;
                return `<div class="flex justify-between text-sm bg-gray-50 p-2 rounded-lg"><span>${item.name}</span><b>₹${item.price}</b></div>`;
            }).join('');
            totalEl.innerText = `₹${total}`;
        }

        // --- 3. आर्डर प्लेस करना ---
        window.placeOrder = async () => {
            if (cart.length === 0) return alert("कार्ट खाली है!");
            const phone = prompt("आपका मोबाइल नंबर दर्ज करें:");
            if (!phone) return;

            try {
                await addDoc(collection(db, "orders"), {
                    phone: phone,
                    items: cart,
                    total: cart.reduce((s, i) => s + i.price, 0),
                    status: "Pending",
                    createdAt: serverTimestamp()
                });
                alert("आर्डर सफल रहा! हम आपसे संपर्क करेंगे।");
                cart = [];
                toggleCart();
            } catch (e) { alert("Error: " + e.message); }
        };

        // वेबसाइट चालू करें
        renderApp();
    </script>
</body>
</html>
