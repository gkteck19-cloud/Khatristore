<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Khatri Admin - ‡§∏‡•ç‡§ü‡•â‡§ï ‡§Æ‡•à‡§®‡•á‡§ú‡§Æ‡•á‡§Ç‡§ü</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-4">

    <div class="max-w-4xl mx-auto">
        <h1 class="text-2xl font-black mb-6 border-b pb-2">üì¶ ‡§è‡§°‡§Æ‡§ø‡§® ‡§™‡•à‡§®‡§≤ (Khatri Store)</h1>

        <div class="bg-white p-6 rounded-2xl shadow-sm mb-8">
            <h2 class="font-bold text-lg mb-4 text-orange-600">‡§∏‡•ç‡§ü‡•â‡§ï ‡§î‡§∞ ‡§ï‡•Ä‡§Æ‡§§ ‡§¨‡§¶‡§≤‡•á‡§Ç</h2>
            <div id="admin-product-list" class="space-y-4">
                <p class="animate-pulse text-gray-400">‡§∏‡§æ‡§Æ‡§æ‡§® ‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...</p>
            </div>
        </div>

        <div class="bg-white p-6 rounded-2xl shadow-sm">
            <h2 class="font-bold text-lg mb-4 text-blue-600">‡§®‡§è ‡§ë‡§∞‡•ç‡§°‡§∞‡•ç‡§∏</h2>
            <div id="admin-order-list" class="space-y-4 text-sm">
                <p class="text-gray-400">‡§ë‡§∞‡•ç‡§°‡§∞‡•ç‡§∏ ‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡•á ‡§π‡•à‡§Ç...</p>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, getDocs, updateDoc, doc, query, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBhNDgsAtOsxdfNGfTEqbuQoYgbtTjUSVo",
            authDomain: "khatri-online.firebaseapp.com",
            projectId: "khatri-online",
            storageBucket: "khatri-online.firebasestorage.app",
            messagingSenderId: "117940742720",
            appId: "1:117940742720:web:5d7dce7c186199e9fbcda5"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // --- 1. ‡§∏‡•ç‡§ü‡•â‡§ï ‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡§∞‡§®‡•á ‡§ï‡§æ ‡§´‡§Ç‡§ï‡•ç‡§∂‡§® ---
        async function loadAdminData() {
            // ‡§™‡•ç‡§∞‡•ã‡§°‡§ï‡•ç‡§ü‡•ç‡§∏ ‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç
            const pSnapshot = await getDocs(collection(db, "products"));
            let pHtml = "";
            pSnapshot.forEach((pDoc) => {
                const p = pDoc.data();
                pHtml += `
                    <div class="flex flex-col md:flex-row justify-between items-start md:items-center p-3 border rounded-xl gap-2">
                        <span class="font-bold text-sm w-40">${p.name}</span>
                        <div class="flex gap-2">
                            <input type="number" id="price-${pDoc.id}" value="${p.price}" class="w-20 border p-1 rounded text-sm" placeholder="Price">
                            <input type="number" id="stock-${pDoc.id}" value="${p.stock}" class="w-16 border p-1 rounded text-sm" placeholder="Stock">
                            <button onclick="updateProduct('${pDoc.id}')" class="bg-slate-900 text-white px-3 py-1 rounded text-xs">Save</button>
                        </div>
                    </div>
                `;
            });
            document.getElementById('admin-product-list').innerHTML = pHtml;

            // ‡§ë‡§∞‡•ç‡§°‡§∞‡•ç‡§∏ ‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç
            const oSnapshot = await getDocs(query(collection(db, "orders"), orderBy("createdAt", "desc")));
            let oHtml = "";
            oSnapshot.forEach((oDoc) => {
                const o = oDoc.data();
                oHtml += `
                    <div class="p-3 bg-gray-50 rounded-xl border-l-4 border-blue-500">
                        <p><b>‡§ó‡•ç‡§∞‡§æ‡§π‡§ï:</b> ${o.phone}</p>
                        <p><b>‡§∏‡§æ‡§Æ‡§æ‡§®:</b> ${o.items.map(i => i.name).join(', ')}</p>
                        <p class="text-blue-700 font-bold">‡§ï‡•Å‡§≤: ‚Çπ${o.total}</p>
                        <p class="text-[10px] text-gray-400">${o.createdAt?.toDate().toLocaleString() || ''}</p>
                    </div>
                `;
            });
            document.getElementById('admin-order-list').innerHTML = oHtml || "‡§ï‡•ã‡§à ‡§Ü‡§∞‡•ç‡§°‡§∞ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§";
        }

        // --- 2. ‡§°‡•á‡§ü‡§æ ‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡§∞‡§®‡§æ ---
        window.updateProduct = async (id) => {
            const newPrice = Number(document.getElementById(`price-${id}`).value);
            const newStock = Number(document.getElementById(`stock-${id}`).value);
            
            try {
                await updateDoc(doc(db, "products", id), {
                    price: newPrice,
                    stock: newStock
                });
                alert("‡§Ö‡§™‡§°‡•á‡§ü ‡§∏‡§´‡§≤!");
            } catch (e) { alert("Error: " + e.message); }
        };

        loadAdminData();
    </script>
</body>
</html>
